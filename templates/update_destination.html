{% extends "base.html" %}
{% block title %}旅行記録編集画面{{ block.super }}{% endblock %}
{% block content %}
    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <div id='map'></div>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAVWmrJ3ty7utzecOnva4f2QQ3ryVYsqeI&callback=initMap" async defer></script>
    <script>
        var map;
        var marker;

        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: {lat: 0, lng: 0},
                zoom: 2
            });

            // マップ上でクリックされたときにピンを立てるイベントリスナーを追加
            map.addListener('click', function(event) {
                placeMarker(event.latLng);
            });
        }
            function placeMarker(destination) {
                // 以前に立てられたマーカーがあれば削除
                if (marker) {
                    marker.setMap(null);
                }
                // 新しいマーカーを立てる
                marker = new google.maps.Marker({
                    position: destination,
                    map: map
                });

                // 緯度と経度を取得
                var latitude = destination.lat();
                var longitude = destination.lng();
            
                // フォームの入力フィールドに緯度と経度を設定
                document.getElementById('id_latitude').value = latitude;
                document.getElementById('id_longitude').value = longitude;
            }
        

    </script>

            {% bootstrap_javascript jquery='full' %} 
            {{ update_form.media }}
            {{ update_form.as_p }}
        <input type="submit" value="更新">
        {% if destination.picture %}
            <p><img src={{ destination.picture.url }}></img></p>
        {% endif %}
    </form>
    <p><a href="{% url 'TravelApp:delete_destination' destination_id=destination.destination_id %}">削除する</a></p>
{% endblock %}


